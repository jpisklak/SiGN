---
title: "Rats Are Not Pigeons: Generalising the SiGN Model"
---

```{r, include = FALSE}
library(knitr)
opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

It is often said that "*pigeons are just rats with wings*," but is that really true? Within the suboptimal choice literature, the humble yet robust pigeon (*Columba livia*) has been, without question, the most widely studied organism. Rats (*Rattus norvegicus*) by contrast, despite their extensive history within the study of learning and behaviour, have received comparatively less attention in this domain. Cunningham and Shahan (2019) examined $N = 10$ rats using a suboptimal choice procedure that closely mirrored the contingencies employed by Stagner and Zentall (2010) in their work with pigeons. They evaluated the rats' behaviour using their excellent *Temporal Information–Theoretic Model*, which is grounded in information theory.  However, their data can also be analysed through the lens of the SiGN model’s functionalist framework, offering an alternative perspective on the observed behaviour. The dataset cs_2019 contains all the necessary parameters for model evaluation.

Prior to drawing predictions from the SiGN model, it is worth examining the individual performance of Cunningham and Shahan's (2019) rats:

```{r, message = FALSE}
library(SiGN)
library(tidyverse)
```

```{r message = FALSE}
# NOTE TO SELF: REMOVE WHEN DATA IS SUPPLIED
cs_2019 <- read_csv("C:/Users/piskl/Desktop/Projects/SiGN/dev/Cunningham_Shahan_2019/gen_data/Cunningham_&_Shahan_2019.csv")
```

```{r fig.width = 9, fig.height = 5, fig.align = 'center'}
# Plot of Individual Rats
ggplot(cs_2019, aes(x = tl_dur_a1, y = cp)) +
  geom_point(size = 2) +
  geom_line(aes(group = subject)) +
  facet_wrap(~ subject, nrow = 2) +
  coord_cartesian(xlim = c(0, 50)) +
  labs(
    x = "Terminal Link Duration (s)",
    y = "Proportion of Suboptimal Choice"
  )
```

Notably, the degree of suboptimal choice appears to increase with longer terminal link durations. This trend aligns with a core prediction of the SiGN model, as illustrated in the plot below.

```{r fig.width = 5, fig.height = 3, fig.align = 'center'}
x_vals <- seq(0.01, 50, by = 0.01)

params <- choice_params("zentall",
  tl_dur_a1 = x_vals,
  tl_dur_a2 = x_vals,
  tl_dur_b1 = x_vals,
  tl_dur_b2 = x_vals,
)
mod <- SiGN(params)$details

ggplot(mapping = aes(x = seq(0.01, 50, by = 0.01), y = mod$cp)) +
  geom_line(linewidth = 1.5) +
  labs(
    x = "Terminal Link Duration",
    y = "Predicted Suboptimal Choice",
    title = "Predicted Suboptimal Choice as a Function of Terminal Link Duration\nUsing Stagner & Zentall (2010) Parameters"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(size = 12))
```

However, the predicted increase in suboptimal choice with terminal link duration is considerably steeper than what most of the rats actually exhibited. It is important to recognise that the SiGN model has its roots in studies of pigeon behaviour. In particular, it was developed in the context of models such as the delay-reduction hypothesis and the matching law. Pigeons are also well known to exhibit steep rates of temporal discounting (i.e., they are quite impatient), meaning that even short delays have a strong impact on their behaviour. The SiGN model has, for better or worse, inherited this characteristic of pigeons. 

Research on learning and behaviour has demonstrated substantial overlap in general learning principles across pigeons, rats, and other species. Consequently, while it’s not unreasonable to presume that factors such as the rate of terminal reinforcement and conditional reinforcement (via delay-reduction) influence the behaviour of both pigeons and rats, it is unlikely that these factors affect the two species equally in all cases. Delays seem much more relevant to pigeons than rats.

## Generalising the SiGN Model

The standard (*a priori*) form of the SiGN model is:

$$
\begin{equation}
\tag{1}
\begin{aligned}
\frac{R_a}{R_a + R_b} &= \frac{r_a\delta_a}{r_a\delta_a + r_b\delta_b} && \text{ when } \delta_a > 0, \delta_b > 0 \\
&= 1 && \text{ when } \delta_a > 0, \delta_b < 0  \\
&= 0 && \text{ when } \delta_a < 0, \delta_b > 0 
\end{aligned}
\end{equation}
$$

In its current form, the SiGN model is a deterministic formulation in which behaviour is directly proportional to the product of terminal reinforcement rate ($r$) and conditional reinforcement (i.e., delay reduction, $\delta$) for each alternative.

While theoretically elegant, this model lacks flexibility to account for empirical variation in sensitivity to its components. In particular, it assumes that organisms weigh terminal reinforcement rate and conditional reinforcement linearly and equally across all conditions. It also assumes that any response bias is either absent or fully determined by the structure of the task.

To account for individual differences and systematic deviations from the model's strict assumptions, we can take a conceptually similar approach to that used in other models of operant choice — most notably the Generalized Matching Law (Baum, 1974). Specifically, we can introduce free parameters that allow the model to estimate sensitivity to terminal reinforcement rate, sensitivity to conditional reinforcement, and overall response bias favouring one alternative. These parameters allow us to effectively scale or weigh the respective components of the model.

Thus, a more general form of the SiGN model can be expressed as:

$$
\begin{equation}
\tag{2}
\begin{aligned}
\frac{R_a}{R_a + R_b} &= 
\frac{b \cdot r_a^{k_r} \cdot \tilde{\delta}_a^{k_d}}{b \cdot r_a^{k_r} \cdot \tilde{\delta}_a^{k_d} + r_b^{k_r} \cdot \tilde{\delta}_b^{k_d}}
\\ \\
\text{where }\tilde{\delta}_i &= \max(\delta_i, \varepsilon), \quad i \in \{a, b\}
\\
\text{and } \varepsilon &> 0
\end{aligned}
\end{equation}
$$
where:

- $k_r$ is the sensitivity to terminal reinforcement rate.
- $k_d$ is the sensitivity to conditional reinforcement (i.e., delay reduction).
- $b$ represents bias towards alternative A.
- $\tilde{\delta}_i$ is a lower-bounded version of $\delta_i$ used to preserve the theoretical boundary behaviour from Equation 1 and ensure numerical stability during model fitting.

For those familiar with the Generalized Matching Law, the inclusion of sensitivity and bias parameters is by now a standard convention in behavioural science. However, the use of $\tilde{\delta}_i$ warrants additional explanation.

In Equation 1, $\delta$ can potentially be any real number (i.e., it can be positive, negative, or zero). In particular, when it is negative or zero, Equation 1 says the decision is simple for the organism: just always choose the option with a positive $\delta$.

While this logic is theoretically sound, it poses a problem when fitting the model to real data using statistical tools. **Specifically, most fitting methods struggle with abrupt cutoffs or discontinuities, and instead require the model to be smooth and continuous to optimise parameters effectively.** We can fix this by introducing a small tweak to $\delta$.

To address this, we define a new version of $\delta$, denoted $\tilde{\delta}$, which behaves identically to the original except when $\delta$ is zero or negative. In such cases, it is replaced with a small positive constant (e.g., 0.0001). This modification does not substantially alter the model's predictions but ensures numerical stability and continuity. The conditional boundaries in Equation 1 primarily serve to constrain the model's output to the [0, 1] interval, which is essential when predicting proportions of choice.


This (admittedly confusing) portion of the model:

$$
\tilde{\delta}_i = \max(\delta_i, \varepsilon), \quad i \in \{a, b\} \\
\text{and } \varepsilon > 0
$$

simply states that for either alternative A or B, $\tilde{\delta}$ is equal to the larger of the two values: $\delta$ or $\varepsilon$, where $\varepsilon$ is a small positive constant. The $\max()$ function is just a notational shorthand indicating that the greater of the two values should be taken. So, if $\delta$ is zero or negative, $\tilde{\delta}$ defaults to $\varepsilon$ instead.

## Back to the Rats

To fit this generalized version of the SiGN model to the individual rats we will first build the necessary list of parameters using the `choice_params()` function and the columns inside `cs_2019`, which are already appropriately named.

```{r}
# Build list of parameters
params <- do.call(choice_params, as.list(cs_2019[3:18]))
```

This selects columns corresponding to the reinforcement and delay-reduction parameters required by choice_params().

**We can then use the `SiGN()` function to calculate the majority of the model values we need. We can also simultaneously organize the data so that the important information we need to fit the model is contained within a single data frame. Along these lines, adding a column of subject names, terminal link durations, and the observed rat choice proportions will be helpful.  There is also no need to keep the a priori predictions the SiGN model generates, since they are all going to be replaced by the predictions of the fitted model.**

```{r}
# Apply the SiGN() function to obtain model values
preds <- SiGN(params)$details |>
  # add useful columns and remove the a priori predictions.
  mutate(subject = cs_2019$subject,
         tl_dur = cs_2019$tl_dur_a1,
         cp_obs = cs_2019$cp) |> 
  # keep important columns only
  select(subject, tl_dur, r_a, r_b, cr_a, cr_b, cp_obs)
```

Examining the calculated delta values, we can see that quite a few are in the negative range.

```{r}
summary(preds$cr_a)
summary(preds$cr_b)
```

This means we will need to replace any $\delta$ values less than our stated epsilon, which we will define as $\epsilon = 10^{-4}$.  That should be a close enough approximation of zero without running into issues with the model fitting process. R's `pmax()` function is ideal for this.

```{r}
epsilon <- 1e-4
preds$cr_a <- pmax(preds$cr_a, epsilon)
preds$cr_b <- pmax(preds$cr_b, epsilon)
```

Next we can fit the model using the information stored in the data frame `preds`.  We will specifically fit the model using the `nlsLM()` function from the R package **minpack.lm**, and have a simple for-loop to iterate through the rats.

```{r}
library(minpack.lm)

# Function for generalized version's model
SiGN_gen <- function(b, k_r, k_d, r_a, r_b, cr_a, cr_b) {
         (b * (r_a^k_r * cr_a^k_d)) /
         (b * (r_a^k_r * cr_a^k_d) + r_b^k_r * cr_b^k_d)
}

# For-loop storage
N <- nrow(cs_2019)
preds$cp_fit <- numeric(N)
preds$b <- numeric(N)
preds$k_r <- numeric(N)
preds$k_d <- numeric(N)

# For-loop to fit the generalised model to each rat's data individually
rat <- unique(cs_2019$subject)

for (i in 1:length(rat)){
  rows <- which(preds$subject == rat[i])
  df <- preds[rows,]

  fit <- nlsLM(
    cp_obs ~ SiGN_gen(b, k_r, k_d, r_a, r_b, cr_a, cr_b),
    data = df,
    start = list(b = 1, k_r = 2, k_d = .05), # choose sensible starting params
    lower = c(epsilon, epsilon, epsilon),
    control = nls.lm.control(maxiter = 100)
  )
  
  # Store values
  preds$cp_fit[rows] <- predict(fit) # predictions
       preds$b[rows] <- summary(fit)$parameters[1, 1]
     preds$k_r[rows] <- summary(fit)$parameters[2, 1]
     preds$k_d[rows] <- summary(fit)$parameters[3, 1]

}
```

```{r fig.width = 9, fig.height = 5, fig.align = 'center'}
# Plot data
preds_long <- pivot_longer(preds,
  cols = c(cp_obs, cp_fit),
  names_to = "cp_type",
  values_to = "cp"
)

preds_long$cp_type <- factor(preds_long$cp_type,
  levels = c("cp_obs", "cp_fit"),
  labels = c("Observed", "Predicted")
)

# Plot
ggplot(preds_long, aes(x = tl_dur, y = cp)) +
  geom_line(aes(colour = cp_type, linetype = cp_type)) +
  geom_point(aes(colour = cp_type, shape = cp_type),
    size = 2
  ) +
  scale_colour_manual(values = palette.colors(n = 2, palette = "R4")) +
  facet_wrap(~subject, nrow = 2) +
  coord_cartesian(xlim = c(0, 50)) +
  labs(
    x = "Terminal Link Duration (s)",
    y = "Suboptimal Choice Proportion",
    colour = " ", shape = " ", linetype = " "
  ) +
  theme(legend.position = "top")
  

```

The plot above illustrates the observed and predicted suboptimal choice behaviour for each rat under varying terminal link durations. While the generalised SiGN model captures the overall trend in many cases, the degree of fit varies across individuals — reflecting differences in sensitivity to reinforcement and delay.

We will also create a data frame illustrating the various sensitivity and bias estimates obtained for each rat.

```{r}
# Summarise parameters by subject
preds |>
  group_by(subject) |>
  summarise(
    b    = mean(b),
    k_r  = mean(k_r),
    k_d  = mean(k_d)
  )
```


## To sum it all up

In this article, we explored the generalisation of the SiGN model to account for systematic variation in sensitivity to reinforcement rate and delay-reduction — an extension motivated by both theoretical considerations and empirical data from rats. While the original SiGN formulation captures core choice dynamics in pigeons, its strict assumptions about linearity and determinism may limit its fit to other species or contexts.

By introducing free parameters for sensitivity ($k_r$, $k_d$) and bias ($b$), and implementing a numerically stable modification to the delay-reduction term ($\tilde\delta$), we were able to adapt the model for empirical fitting using nonlinear least squares. The fitted model shows a reasonable approximation to the observed suboptimal choice data in rats, though individual differences in parameter estimates highlight the variability in how different animals weigh reinforcement and delay.

These results reinforce the idea that while general principles of reinforcement learning may be conserved across species, their expression can differ in important ways. The generalised SiGN model thus provides a flexible framework for capturing such differences, while remaining grounded in functionalist principles.


## References

Baum, W. M. (1974). On two types of deviation from the matching law: Bias and undermatching. *Journal of the Experimental Analysis of Behavior*, *22*(1), 231–242. https://doi.org/10.1901/jeab.1974.22-231

Cunningham, P. J., & Shahan, T. A. (2018). Suboptimal choice, reward-predictive signals, and temporal information. *Journal of Experimental Psychology. Animal Learning and Cognition*, *44*(1), 1–22. https://doi.org/10.1037/xan0000160

Cunningham, P. J., & Shahan, T. A. (2019). Rats engage in suboptimal choice when the delay to food is sufficiently long. *Journal of Experimental Psychology. Animal Learning and Cognition*, *45*(3), 301–310. https://doi.org/10.1037/xan0000211

Stagner, J. P., & Zentall, T. R. (2010). Suboptimal choice behavior by pigeons. *Psychonomic Bulletin & Review*, *17*(3), 412–416. https://doi.org/10.3758/PBR.17.3.412
